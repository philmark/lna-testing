<html>
    <head>
    </head>
    <body>
        <p class="lnaState">
            LNA State: unknown
        </p>

        <script>
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js', { scope: './' }).then(reg => {
                    console.log('Service Worker registered with scope:', reg.scope);
                }).catch(err => {
                    console.log('Service Worker registration failed:', err);
                });
            }

            async function getLNAState() {
                try {
                    const permission = await navigator.permissions.query({ name: 'local-network-access' });
                    let lnaPermission = permission?.state || 'unknown';
                    permission.onchange = () => {
                        console.log('Local Network Access permission state changed to:', permission.state);
                        lnaPermission = permission.state;

                        const lnaStateElement = document.querySelector('.lnaState');
                        lnaStateElement.textContent = `LNA State: ${lnaPermission}`;
                    };
                    return lnaPermission;
                } catch (error) {
                    return 'unknown';
                }
            }

            window.addEventListener('load', async () => {
                const lnaStateElement = document.querySelector('.lnaState');
                const state = await getLNAState();
                lnaStateElement.textContent = `LNA State: ${state}`;
            });
        </script>
    </body>
</html>